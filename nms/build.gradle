import java.util.function.Consumer
import java.util.function.Supplier

apply plugin: 'org.screamingsandals.nms-mapper'

sourceSets.main.java.srcDirs += 'src/generated/java'

// after any changes in this file, please rebuild project to see changes in your ide

nmsGen {
    basePackage = "org.screamingsandals.bedwars.lib.nms.accessors"
    sourceSet = "src/generated/java"
    cleanOnRebuild = true
    minMinecraftVersion = "1.8.8"

    // spigot: prefix means that spigot mapping will be used, for spigot mappings we don't specify package
    var NBTTagCompound = reqClass('spigot:NBTTagCompound')
            .reqConstructor()
            .reqMethod('searge:func_74768_a', String, int)
    var IChatBaseComponent = reqClass('spigot:IChatBaseComponent')
            .reqMethod('spigot:getLegacyString')
            .reqMethod('getString')
    var IAttribute = reqClass('net.minecraft.world.entity.ai.attributes.Attribute')
    reqClass('spigot:IChatBaseComponent$ChatSerializer')
        .reqMethod('searge:func_150699_a', String) // spigot don't have mapping for that and I think obfuscated:a can successfully fail
        .reqMethod('searge:func_240643_a_', String) // 1.16+
    var DataWatcher = reqClass('spigot:DataWatcher')
    var World = reqClass('spigot:World')
            .reqMethod('spigot:getMethodProfilerSupplier') // 1.17 and newer
            .reqMethod('spigot:getMethodProfiler') // for something between new and old versions
            .reqField('spigot:methodProfiler:1.9.4') // for older versions
    var Entity = reqClass('spigot:Entity')
        .reqField('spigot:world')
        .reqMethod('spigot:getWorld')
        .reqMethod('searge:func_184198_c', NBTTagCompound)
        .reqMethod('searge:func_70020_e', NBTTagCompound)
        .reqMethod('spigot:setLocation', double, double, double, float, float)
        .reqMethod('spigot:getId')
        .reqMethod('spigot:getDataWatcher')
        .reqMethod('spigot:setCustomName', IChatBaseComponent)
        .reqMethod('spigot:locX')
        .reqMethod('spigot:locY')
        .reqMethod('spigot:locZ')
        .reqMethod('spigot:getYRot')
        .reqMethod('spigot:getXRot')
        .reqMethod('spigot:getCustomName')
        .reqMethod('spigot:setCustomNameVisible', boolean)
        .reqMethod('spigot:getCustomNameVisible')
        .reqMethod('spigot:setInvisible', boolean)
        .reqMethod('spigot:isInvisible')
        .reqMethod('spigot:setNoGravity', boolean)
        .reqMethod('spigot:isNoGravity')
        // old
        .reqField('spigot:yaw')
        .reqField('spigot:pitch')
        .reqField('spigot:locX')
        .reqField('spigot:locY')
        .reqField('spigot:locZ')
        .reqMethod('spigot:setCustomName', String)
    reqClass('spigot:EntityArmorStand')
        .reqConstructor(World, double, double, double)
        .reqMethod('spigot:setSmall', boolean)
        .reqMethod('spigot:isSmall')
        .reqMethod('spigot:setArms', boolean)
        .reqMethod('spigot:hasArms')
        .reqMethod('spigot:setBasePlate', boolean)
        .reqMethod('spigot:hasBasePlate')
        .reqMethod('spigot:setMarker', boolean)
        .reqMethod('spigot:isMarker')
    var EntityCreature = reqClass('spigot:EntityCreature')
    var EntityInsentient = reqClass('spigot:EntityInsentient')
        .reqField('spigot:goalSelector')
        .reqField('spigot:targetSelector')
        .reqField('spigot:goalTarget')
    var EntityLiving = reqClass('spigot:EntityLiving')
        .reqMethod('spigot:getAttributeInstance', IAttribute)
        .reqMethod('spigot:getAttributeMap')
        .reqMethod('spigot:getCombatTracker')
    reqClass('spigot:AttributeMapBase')
        .reqMethod('searge:func_111150_b', IAttribute)
        .reqField('searge:field_233777_d_') // provider
    reqClass('spigot:AttributeProvider')
        .reqField('searge:field_233802_a_')
    reqClass('spigot:EntityPlayer')
        .reqField('spigot:playerConnection')
        .reqMethod('tellNeutralMobsThatIDied')
        .reqMethod('spigot:setSpectatorTarget', Entity)
    var EnumClientCommand = reqClass('spigot:PacketPlayInClientCommand$EnumClientCommand')
        .reqEnumField('spigot:PERFORM_RESPAWN')
    var EnumTitleAction = reqClass('spigot:PacketPlayOutTitle$EnumTitleAction') // does not exist in 1.17
        .reqEnumField('spigot:TITLE')
        .reqEnumField('spigot:SUBTITLE')
        .reqEnumField('spigot:TIMES')
    reqClass('spigot:GenericAttributes')
        .reqField('spigot:MAX_HEALTH')
        .reqField('spigot:FOLLOW_RANGE')
        .reqField('spigot:KNOCKBACK_RESISTANCE')
        .reqField('spigot:MOVEMENT_SPEED')
        .reqField('spigot:FLYING_SPEED')
        .reqField('spigot:ATTACK_DAMAGE')
        .reqField('spigot:ATTACK_KNOCKBACK')
        .reqField('spigot:ATTACK_SPEED')
        .reqField('spigot:ARMOR')
        .reqField('spigot:ARMOR_TOUGHNESS')
        .reqField('spigot:LUCK')
    var Packet = reqClass('spigot:Packet')
    var PacketPlayInClientCommand = reqClass('spigot:PacketPlayInClientCommand')
        .reqConstructor(EnumClientCommand)
    reqClass('spigot:PacketPlayInUseEntity')
        .reqField('searge:field_149567_a')
    reqClass('spigot:PacketPlayOutEntityDestroy')
        .reqConstructor(int) // 1.17 retardation
        .reqConstructor(int[])
    reqClass('spigot:PacketPlayOutEntityMetadata')
        .reqConstructor(int, DataWatcher, boolean)
    reqClass('spigot:PacketPlayOutEntityTeleport')
        .reqConstructor(Entity)
    reqClass('spigot:PacketPlayOutExperience')
        .reqConstructor(float, int, int)
    reqClass('spigot:PacketPlayOutSpawnEntity')
        .reqConstructor(EntityLiving)
    reqClass('spigot:PacketPlayOutSpawnEntityLiving')
        .reqConstructor(EntityLiving)
    reqClass('spigot:PacketPlayOutTitle') // does not exist in 1.17
        .reqConstructor(EnumTitleAction, IChatBaseComponent)
        .reqConstructor(EnumTitleAction, IChatBaseComponent, int, int, int)
    reqClass('spigot:PacketPlayOutWorldParticles')
    var PathfinderGoal = reqClass('spigot:PathfinderGoal')
    reqClass('spigot:PathfinderGoalSelector')
        .reqConstructor(Supplier)
        .reqMethod('searge:func_75776_a', int, PathfinderGoal)
    reqClass('spigot:PathfinderGoalMeleeAttack')
        .reqConstructor(EntityCreature, double, boolean)
    reqClass('spigot:PathfinderGoalNearestAttackableTarget')
        .reqConstructor(EntityInsentient, Class, boolean)
    reqClass('spigot:PlayerConnection')
        .reqField('spigot:networkManager')
        .reqMethod('spigot:sendPacket', Packet)
        .reqMethod('searge:func_147342_a', PacketPlayInClientCommand)
    reqClass('spigot:NetworkManager')
        .reqField('spigot:channel')
    reqClass('spigot:PacketPlayOutPlayerListHeaderFooter')
        .reqConstructor()
        .reqConstructor(IChatBaseComponent, IChatBaseComponent)
        .reqField('spigot:header')
        .reqField('spigot:footer')
    reqClass('net.minecraft.world.entity.ai.attributes.AttributeInstance')
        .reqConstructor(IAttribute, Consumer)
        .reqMethod('spigot:setValue', double)
        .reqMethod('spigot:getValue')
    reqClass('spigot:CombatTracker')
        .reqMethod('spigot:getDeathMessage')
        .reqMethod('recheckStatus')
    reqClass('spigot:EntityHuman')
        .reqMethod('spigot:releaseShoulderEntities')
}

tasks.getByName('compileJava').dependsOn('generateNmsComponents')